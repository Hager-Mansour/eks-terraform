# =========================
# Monitoring (Prometheus + Grafana)
# =========================

- name: Add Prometheus Helm repository
  shell: helm repo add prometheus-community https://prometheus-community.github.io/helm-charts || true
  changed_when: false

- name: Add Grafana Helm repository
  shell: helm repo add grafana https://grafana.github.io/helm-charts || true
  changed_when: false

- name: Update Helm repositories
  command: helm repo update
  changed_when: false

- name: Install Prometheus (CI safe)
  command: >
    helm upgrade --install prometheus prometheus-community/prometheus
    --namespace monitoring
    --create-namespace
    --no-hooks
  changed_when: false

- name: Install Grafana (CI safe)
  command: >
    helm upgrade --install grafana grafana/grafana
    --namespace monitoring
    --create-namespace
    --no-hooks
  changed_when: false
